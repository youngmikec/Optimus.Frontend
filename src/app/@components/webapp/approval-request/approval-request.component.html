<ng-container
  *ngIf="{
    authorizationRequestSummary: authorizationRequestSummary$ | async,
    authorizationRequestSummaryLoading:
      authorizationRequestSummaryLoading$ | async
  } as obs"
>
  <section id="approval-request">
    <div class="cards-section">
      <div class="stat-card">
        <div class="stat-card-icon">
          <svg
            width="40"
            height="40"
            viewBox="0 0 40 40"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="20" cy="20" r="20" fill="white" />
            <ellipse cx="20" cy="20" rx="16" ry="16" fill="#0235CD" />
            <g clip-path="url(#clip0_21928_60144)">
              <path
                d="M15.8105 13.627V11H15.81L13.1836 13.6264V13.627H15.8105Z"
                fill="white"
              />
              <path
                d="M15.9531 19.3594H18.3552V23.9063H15.9531V19.3594Z"
                fill="white"
              />
              <path
                d="M17.5081 11C17.153 11 16.8652 11.2878 16.8652 11.6429V14.0388C16.8652 14.3939 16.5774 14.6817 16.2224 14.6817H13.8265C13.4714 14.6817 13.1836 14.9695 13.1836 15.3245V28.3571C13.1836 28.7122 13.4714 29 13.8265 29H26.1763C26.5313 29 26.8192 28.7122 26.8192 28.3571V11.6429C26.8192 11.2878 26.5313 11 26.1763 11H17.5081ZM19.4084 24.3152C19.4084 24.6702 19.1206 24.958 18.7655 24.958H15.5398C15.1848 24.958 14.8969 24.6702 14.8969 24.3152V18.9446C14.8969 18.5895 15.1848 18.3017 15.5398 18.3017H18.7655C19.1206 18.3017 19.4084 18.5895 19.4084 18.9446V24.3152ZM25.1387 24.4307C25.1387 24.722 24.9026 24.958 24.6113 24.958H21.0889C20.7977 24.958 20.5616 24.722 20.5616 24.4307C20.5616 24.1395 20.7977 23.9034 21.0889 23.9034H24.6113C24.9026 23.9034 25.1387 24.1395 25.1387 24.4307ZM25.1387 22.1901C25.1387 22.4813 24.9026 22.7174 24.6113 22.7174H21.0889C20.7977 22.7174 20.5616 22.4813 20.5616 22.1901C20.5616 21.8988 20.7977 21.6627 21.0889 21.6627H24.6113C24.9026 21.6627 25.1387 21.8988 25.1387 22.1901ZM25.1387 19.9494C25.1387 20.2407 24.9026 20.4768 24.6113 20.4768H21.0889C20.7977 20.4768 20.5616 20.2407 20.5616 19.9494C20.5616 19.6582 20.7977 19.4221 21.0889 19.4221H24.6113C24.9026 19.4221 25.1387 19.6582 25.1387 19.9494Z"
                fill="white"
              />
            </g>
            <defs>
              <clipPath id="clip0_21928_60144">
                <rect
                  width="18"
                  height="18"
                  fill="white"
                  transform="translate(11 11)"
                />
              </clipPath>
            </defs>
          </svg>
        </div>
        <div class="stat-card-content">
          <div
            *ngIf="obs.authorizationRequestSummaryLoading; else totalRequests"
          >
            ...
          </div>
          <ng-template #totalRequests>
            <h4 class="opt-heading-6 fw-700 opt-text-white">
              {{ obs.authorizationRequestSummary?.totalRequests ?? 0 }}
            </h4>
          </ng-template>
          <p class="opt-caption opt-text-white">Total Request</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-card-icon">
          <svg
            width="40"
            height="40"
            viewBox="0 0 40 40"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="20" cy="20" r="20" fill="white" />
            <ellipse cx="20" cy="20" rx="16" ry="16" fill="#0235CD" />
            <g clip-path="url(#clip0_21928_60144)">
              <path
                d="M15.8105 13.627V11H15.81L13.1836 13.6264V13.627H15.8105Z"
                fill="white"
              />
              <path
                d="M15.9531 19.3594H18.3552V23.9063H15.9531V19.3594Z"
                fill="white"
              />
              <path
                d="M17.5081 11C17.153 11 16.8652 11.2878 16.8652 11.6429V14.0388C16.8652 14.3939 16.5774 14.6817 16.2224 14.6817H13.8265C13.4714 14.6817 13.1836 14.9695 13.1836 15.3245V28.3571C13.1836 28.7122 13.4714 29 13.8265 29H26.1763C26.5313 29 26.8192 28.7122 26.8192 28.3571V11.6429C26.8192 11.2878 26.5313 11 26.1763 11H17.5081ZM19.4084 24.3152C19.4084 24.6702 19.1206 24.958 18.7655 24.958H15.5398C15.1848 24.958 14.8969 24.6702 14.8969 24.3152V18.9446C14.8969 18.5895 15.1848 18.3017 15.5398 18.3017H18.7655C19.1206 18.3017 19.4084 18.5895 19.4084 18.9446V24.3152ZM25.1387 24.4307C25.1387 24.722 24.9026 24.958 24.6113 24.958H21.0889C20.7977 24.958 20.5616 24.722 20.5616 24.4307C20.5616 24.1395 20.7977 23.9034 21.0889 23.9034H24.6113C24.9026 23.9034 25.1387 24.1395 25.1387 24.4307ZM25.1387 22.1901C25.1387 22.4813 24.9026 22.7174 24.6113 22.7174H21.0889C20.7977 22.7174 20.5616 22.4813 20.5616 22.1901C20.5616 21.8988 20.7977 21.6627 21.0889 21.6627H24.6113C24.9026 21.6627 25.1387 21.8988 25.1387 22.1901ZM25.1387 19.9494C25.1387 20.2407 24.9026 20.4768 24.6113 20.4768H21.0889C20.7977 20.4768 20.5616 20.2407 20.5616 19.9494C20.5616 19.6582 20.7977 19.4221 21.0889 19.4221H24.6113C24.9026 19.4221 25.1387 19.6582 25.1387 19.9494Z"
                fill="white"
              />
            </g>
            <defs>
              <clipPath id="clip0_21928_60144">
                <rect
                  width="18"
                  height="18"
                  fill="white"
                  transform="translate(11 11)"
                />
              </clipPath>
            </defs>
          </svg>
        </div>
        <div class="stat-card-content">
          <div
            *ngIf="
              obs.authorizationRequestSummaryLoading;
              else acceptedRequests
            "
          >
            ...
          </div>
          <ng-template #acceptedRequests>
            <h4 class="opt-heading-6 fw-700">
              {{ obs.authorizationRequestSummary?.acceptedRequests }}
            </h4>
          </ng-template>
          <p class="opt-caption opt-text-neutral">Approved Request</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-card-icon">
          <svg
            width="40"
            height="40"
            viewBox="0 0 40 40"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="20" cy="20" r="20" fill="white" />
            <ellipse cx="20" cy="20" rx="16" ry="16" fill="#0235CD" />
            <g clip-path="url(#clip0_21928_60144)">
              <path
                d="M15.8105 13.627V11H15.81L13.1836 13.6264V13.627H15.8105Z"
                fill="white"
              />
              <path
                d="M15.9531 19.3594H18.3552V23.9063H15.9531V19.3594Z"
                fill="white"
              />
              <path
                d="M17.5081 11C17.153 11 16.8652 11.2878 16.8652 11.6429V14.0388C16.8652 14.3939 16.5774 14.6817 16.2224 14.6817H13.8265C13.4714 14.6817 13.1836 14.9695 13.1836 15.3245V28.3571C13.1836 28.7122 13.4714 29 13.8265 29H26.1763C26.5313 29 26.8192 28.7122 26.8192 28.3571V11.6429C26.8192 11.2878 26.5313 11 26.1763 11H17.5081ZM19.4084 24.3152C19.4084 24.6702 19.1206 24.958 18.7655 24.958H15.5398C15.1848 24.958 14.8969 24.6702 14.8969 24.3152V18.9446C14.8969 18.5895 15.1848 18.3017 15.5398 18.3017H18.7655C19.1206 18.3017 19.4084 18.5895 19.4084 18.9446V24.3152ZM25.1387 24.4307C25.1387 24.722 24.9026 24.958 24.6113 24.958H21.0889C20.7977 24.958 20.5616 24.722 20.5616 24.4307C20.5616 24.1395 20.7977 23.9034 21.0889 23.9034H24.6113C24.9026 23.9034 25.1387 24.1395 25.1387 24.4307ZM25.1387 22.1901C25.1387 22.4813 24.9026 22.7174 24.6113 22.7174H21.0889C20.7977 22.7174 20.5616 22.4813 20.5616 22.1901C20.5616 21.8988 20.7977 21.6627 21.0889 21.6627H24.6113C24.9026 21.6627 25.1387 21.8988 25.1387 22.1901ZM25.1387 19.9494C25.1387 20.2407 24.9026 20.4768 24.6113 20.4768H21.0889C20.7977 20.4768 20.5616 20.2407 20.5616 19.9494C20.5616 19.6582 20.7977 19.4221 21.0889 19.4221H24.6113C24.9026 19.4221 25.1387 19.6582 25.1387 19.9494Z"
                fill="white"
              />
            </g>
            <defs>
              <clipPath id="clip0_21928_60144">
                <rect
                  width="18"
                  height="18"
                  fill="white"
                  transform="translate(11 11)"
                />
              </clipPath>
            </defs>
          </svg>
        </div>
        <div class="stat-card-content">
          <div
            *ngIf="obs.authorizationRequestSummaryLoading; else pendingRequests"
          >
            ...
          </div>
          <ng-template #pendingRequests>
            <h4 class="opt-heading-6 fw-700">
              {{ obs.authorizationRequestSummary?.pendingRequests }}
            </h4>
          </ng-template>
          <p class="opt-caption opt-text-neutral">Pending Requests</p>
        </div>
      </div>
    </div>

    <div class="approval-request-header">
      <h6 class="opt-heading-6 fw-700 mb-0">Approval Request</h6>
    </div>

    <mat-tab-group>
      <mat-tab label="Approval Request">
        <ng-container *ngIf="dataSource !== null; else noTableData">
          <div class="table-responsive">
            <table mat-table [dataSource]="dataSource!" matSort>
              <ng-container matColumnDef="requestId">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Request Id
                </th>
                <td mat-cell *matCellDef="let row" matRipple>
                  <span class="d-flex justify-content-start align-items-center">
                    <span>{{ row?.requestId }} </span>
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="applicant">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Applicant
                </th>
                <td mat-cell *matCellDef="let row" matRipple>
                  {{ row?.applicantFullName }}
                </td>
              </ng-container>

              <ng-container matColumnDef="feature">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Feature
                </th>
                <td mat-cell *matCellDef="let row" matRipple>
                  <span class="d-flex justify-content-start align-items-center">
                    <span>{{ row.createdDate }}</span>
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="dateRequested">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Date Requested
                </th>
                <td mat-cell *matCellDef="let row" matRipple>
                  <span class="d-flex justify-content-start align-items-center">
                    <span>{{ row.createdDate | date }}</span>
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="requestedBy">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Requested By
                </th>
                <td mat-cell *matCellDef="let row" matRipple>
                  <span class="d-flex justify-content-start align-items-center">
                    <span>{{ row.createdBy }}</span>
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Status
                </th>
                <td mat-cell *matCellDef="let row" matRipple>
                  <span
                    [ngClass]="{
                      'status-active': row.status === 1,
                      'status-pending': row.status === 2,
                      'status-inactive': row.status === 3 || row.status === 4
                    }"
                  >
                    <ng-container *ngIf="row.status === 1"
                      >Approved</ng-container
                    >
                    <ng-container *ngIf="row.status === 2"
                      >Pending</ng-container
                    >
                    <ng-container *ngIf="row.status === 3"
                      >Declined</ng-container
                    >
                    <ng-container *ngIf="row.status === 4"
                      >Not Required</ng-container
                    >
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  Actions
                </th>
                <td mat-cell *matCellDef="let row">
                  <div class="table-cta-container">
                    <div
                      class="round-cta-container"
                      [ngClass]="row.status !== 2 ? 'button-diabled' : ''"
                      matRipple
                      [matTooltip]="row.status === 2 ? 'Reject' : ''"
                      matTooltipPosition="above"
                      matTooltipClass="custom-tooltip"
                      (click)="
                        row.status !== 2
                          ? null
                          : onApproveRejectRequest(row.id, 3)
                      "
                    >
                      <ng-container
                        *ngIf="row.status !== 2; else disabledReject"
                      >
                        <img
                          src="/assets/icons/disabled-cancel-icon.svg"
                          alt="reject icon"
                        />
                      </ng-container>
                      <ng-template #disabledReject>
                        <img
                          src="/assets/icons/cancel-icon.svg"
                          alt="reject icon"
                        />
                      </ng-template>
                    </div>

                    <div
                      class="round-cta-container"
                      [ngClass]="row.status !== 2 ? 'button-diabled' : ''"
                      matRipple
                      [matTooltip]="row.status === 2 ? 'Approve' : ''"
                      matTooltipPosition="above"
                      matTooltipClass="custom-tooltip"
                      (click)="
                        row.status !== 2
                          ? null
                          : onApproveRejectRequest(row.id, 1)
                      "
                    >
                      <ng-container
                        *ngIf="row.status !== 2; else disabledApproved"
                      >
                        <img
                          src="/assets/icons/disabled-approve-icon.svg"
                          alt="approve icon"
                        />
                      </ng-container>
                      <ng-template #disabledApproved>
                        <img
                          src="/assets/icons/approve-icon.svg"
                          alt="approve icon"
                        />
                      </ng-template>
                    </div>

                    <div
                      class="round-cta-container"
                      matRipple
                      matTooltip="Menu"
                      matTooltipPosition="above"
                      matTooltipClass="custom-tooltip"
                      [matMenuTriggerFor]="menu"
                    >
                      <img
                        src="/assets/icons/menu-icon.svg"
                        alt="approve icon"
                      />
                    </div>

                    <mat-menu #menu="matMenu" class="feature-menu">
                      <ul class="list-group feature-menu-list">
                        <li
                          matRipple
                          class="list-group-item"
                          (click)="viewQuote(row.applicationQuoteId)"
                          role="button"
                        >
                          <div class="item-holder">
                            <span class="opt-para-1"> View Quote </span>
                          </div>
                        </li>

                        <li
                          matRipple
                          class="list-group-item"
                          role="button"
                          (click)="
                            getApprovalDocument(
                              row.engagementProfileFileUrl,
                              row.requestId
                            )
                          "
                        >
                          <div class="item-holder">
                            <span class="opt-para-1">
                              View Engagement Profile
                            </span>
                          </div>
                        </li>
                      </ul>
                    </mat-menu>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

              <!-- Row shown when there is no matching data. -->
              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">No matching data"</td>
              </tr>
            </table>
          </div>
          <mat-paginator
            [pageSizeOptions]="[
              10, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90,
              95, 100
            ]"
            showFirstLastButtons
            [pageSize]="10"
            [hidePageSize]="false"
            [length]="totalRecords"
            (page)="onPaginationChange($event)"
          >
          </mat-paginator>
        </ng-container>

        <ng-template #noTableData>
          <app-table-loader></app-table-loader>
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </section>
</ng-container>
